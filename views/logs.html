<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="backend for exhibition website">
    <title>logs</title>
    <link id="favicon" rel="icon" href="https://cdn.glitch.com/05eaa61e-b555-434a-9ed1-1f00bdcd2e32%2Ffavicon.png?v=1618028934476" type="image/png">
    <link rel="stylesheet" href="/logs.css">
    <script src="https://all-at-once.glitch.me/socket.io/socket.io.js"></script>
    <script>
      var socket = io('https://all-at-once.glitch.me/')
      
      // convert the timestamp into date & time
      const convert = (timestamp) => {
        let date = new Date(timestamp)
        let YY = date.getFullYear()
        let MM = ("0" + date.getMonth()).slice(-2)
        let DD = ("0" + date.getDate()).slice(-2)
        let hh = ("0" + date.getHours()).slice(-2)
        let mm = ("0" + date.getMinutes()).slice(-2)
        let ss = ("0" + date.getSeconds()).slice(-2)
        let time = `${YY}/${MM}/${DD} ${hh}:${mm}:${ss}`
        return time
      }
      
      window.onload = async () => {
        
        const table = document.querySelector('table')
        
        // add the latest log
        socket.on('add log', (log)=>{
          let output = `
            <tr>
              <td>${convert(log.timestamp)}</td>
              <td>${log.description}</td>
            </tr>
          `
          table.insertAdjacentHTML('afterbegin', output)
        })
        
        // get all the logs when the page is freshed
        socket.on('refresh logs', (logs)=>{
          let output = ''
          for (let log of logs) {
            output += `
              <tr>
                <td clss="time">${convert(log.timestamp)}</td>
                <td>${log.description}</td>
              </tr>
            `
          }
          table.innerHTML = output
        })
        
      }
    </script>
  </head>
  <body>
    <div id="blink">&#10074;</div>
    <table>
      <tr>
        <td class="time">2021/03/23 16:32:20</td>
        <td>The streaming of Poster for a talk by Elmgreen and Dragset by Minhwan in cam_02 just started</td>
      </tr>
    </table>
  </body>
</html>